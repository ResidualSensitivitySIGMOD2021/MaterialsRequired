create table supplier_w as select supplier.S_SUPPKEY, 1 as weight from supplier;
create table ps_w as select partsupp.PS_PARTKEY, partsupp.PS_SUPPKEY, 1 as weight from partsupp;
create table lineitem_w as select lineitem.L_ORDERKEY, lineitem.L_PARTKEY, lineitem.L_SUPPKEY, 1 as weight from lineitem;
create table orders_w as select orders.O_ORDERKEY, 1 as weight from orders;
create table suppkey_w1 as select supplier_w.S_SUPPKEY, sum(supplier_w.weight) as weight from supplier_w group by supplier_w.S_SUPPKEY;
create table suppkey_w2 as select ps_w.PS_SUPPKEY, sum(ps_w.weight) as weight from ps_w group by ps_w.PS_SUPPKEY;
create table supplier_ps_w as select ps_w.PS_PARTKEY, ps_w.PS_SUPPKEY, 1.0*ps_w.weight*supplier_w.weight/(suppkey_w1.weight+suppkey_w2.weight) as weight from ps_w, supplier_w, suppkey_w1, suppkey_w2 where ps_w.PS_SUPPKEY=supplier_w.S_SUPPKEY and ps_w.PS_SUPPKEY=suppkey_w2.PS_SUPPKEY and supplier_w.S_SUPPKEY = suppkey_w1.S_SUPPKEY;
create table orderkey_w1 as select O_ORDERKEY, sum(weight) as weight from orders_w group by O_ORDERKEY;
create table orderkey_w2 as select L_ORDERKEY, sum(weight) as weight from lineitem_w group by L_ORDERKEY;
create table orders_lineitem_w as select lineitem_w.L_PARTKEY, lineitem_w.L_SUPPKEY, 1.0*orders_w.weight*lineitem_w.weight/(orderkey_w1.weight+orderkey_w2.weight) as weight from lineitem_w, orders_w, orderkey_w1, orderkey_w2 where lineitem_w.L_ORDERKEY = orders_w.O_ORDERKEY and orderkey_w1.O_ORDERKEY=orders_w.O_ORDERKEY and orderkey_w2.L_ORDERKEY=lineitem_w.L_ORDERKEY;
create table pskey_w1 as select PS_PARTKEY, PS_SUPPKEY, sum(weight) as weight from supplier_ps_w group by PS_PARTKEY, PS_SUPPKEY;
create table pskey_w2 as select L_PARTKEY, L_SUPPKEY, sum(weight) as weight from orders_lineitem_w group by L_PARTKEY, L_SUPPKEY;
create table supplier_ps_orders_lineitem_w as select 1.0*supplier_ps_w.weight*orders_lineitem_w.weight/(pskey_w1.weight+pskey_w2.weight) as weight from supplier_ps_w, orders_lineitem_w, pskey_w1, pskey_w2 where supplier_ps_w.PS_PARTKEY = orders_lineitem_w.L_PARTKEY and supplier_ps_w.PS_SUPPKEY = orders_lineitem_w.L_SUPPKEY and supplier_ps_w.PS_PARTKEY = pskey_w2.L_PARTKEY and supplier_ps_w.PS_SUPPKEY = pskey_w2.L_SUPPKEY and supplier_ps_w.PS_PARTKEY = pskey_w1.PS_PARTKEY and supplier_ps_w.PS_SUPPKEY = pskey_w1.PS_SUPPKEY;
select sum(weight) from supplier_ps_orders_lineitem_w;
