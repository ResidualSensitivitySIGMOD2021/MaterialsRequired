create table customer_w as select customer.C_NATIONKEY, customer.C_CUSTKEY, 1 as weight from customer;
create table supplier_w as select supplier.S_SUPPKEY, supplier.S_NATIONKEY, 1 as weight from supplier;
create table orders_w as select orders.O_CUSTKEY, orders.O_ORDERKEY, 1 as weight from orders;
create table lineitem_w as select lineitem.L_ORDERKEY , lineitem.L_SUPPKEY, 1 as weight from lineitem;
create table custkey_w1 as select customer_w.C_CUSTKEY, sum(customer_w.weight) as weight from customer_w group by customer_w.C_CUSTKEY;
create table custkey_w2 as select orders_w.O_CUSTKEY, sum(orders_w.weight) as weight from orders_w group by orders_w.O_CUSTKEY;
create table customer_orders_w as select customer_w.C_NATIONKEY, orders_w.O_ORDERKEY, 1.0*orders_w.weight*customer_w.weight/(custkey_w1.weight+custkey_w2.weight) as weight from customer_w, orders_w, custkey_w1, custkey_w2 where customer_w.C_CUSTKEY=orders_w.O_CUSTKEY and custkey_w1.C_CUSTKEY = customer_w.C_CUSTKEY and custkey_w2.O_CUSTKEY = orders_w.O_CUSTKEY;
create table suppkey_w1 as select supplier_w.S_SUPPKEY, sum(supplier_w.weight) as weight from supplier_w group by supplier_w.S_SUPPKEY;
create table suppkey_w2 as select lineitem_w.L_SUPPKEY, sum(lineitem_w.weight) as weight from lineitem_w group by lineitem_w.L_SUPPKEY;
create table supplier_lineitem_w as select supplier_w.S_NATIONKEY, lineitem_w.L_ORDERKEY, 1.0*lineitem_w.weight*supplier_w.weight/(suppkey_w1.weight+suppkey_w2.weight) as weight from lineitem_w, supplier_w, suppkey_w1, suppkey_w2 where lineitem_w.L_SUPPKEY=supplier_w.S_SUPPKEY and suppkey_w1.S_SUPPKEY = supplier_w.S_SUPPKEY and lineitem_w.L_SUPPKEY=suppkey_w2.L_SUPPKEY;
create table orderkey_w1 as select C_NATIONKEY, O_ORDERKEY, sum(weight) as weight from customer_orders_w group by C_NATIONKEY, O_ORDERKEY;
create table orderkey_w2 as select S_NATIONKEY, L_ORDERKEY, sum(weight) as weight from supplier_lineitem_w group by S_NATIONKEY, L_ORDERKEY;
create table customer_orders_supplier_lineitem_w as select 1.0*customer_orders_w.weight*supplier_lineitem_w.weight/(orderkey_w1.weight+orderkey_w2.weight) as weight from customer_orders_w, supplier_lineitem_w, orderkey_w1, orderkey_w2 where customer_orders_w.O_ORDERKEY = supplier_lineitem_w.L_ORDERKEY and customer_orders_w.C_NATIONKEY = supplier_lineitem_w.S_NATIONKEY and orderkey_w1.O_ORDERKEY=customer_orders_w.O_ORDERKEY and customer_orders_w.C_NATIONKEY = orderkey_w1.C_NATIONKEY and orderkey_w2.L_ORDERKEY=supplier_lineitem_w.L_ORDERKEY and customer_orders_w.C_NATIONKEY = orderkey_w2.S_NATIONKEY;
select sum(weight) from customer_orders_supplier_lineitem_w;
